define(["require","exports","tslib","external/react","modules/core/i18n","modules/core/browser","modules/core/exception","modules/clean/ajax","modules/clean/auth/common/types","modules/clean/auth/common/utils","modules/clean/auth/register/types","modules/clean/auth/register/view","modules/clean/form_util/name_parser","modules/clean/profile_services/auth_callback_handler","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/react/css","modules/clean/web_timing_logger"],function(e,t,s,r,o,a,i,n,p,l,m,c,u,d,h,g,_,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(t){var s=e.call(this,t)||this;return s.testOnlyGetViewComponent=function(){return s.viewComponent},s.setViewComponent=function(e){s.viewComponent=e},s.onClickSignUp=function(e){e.preventDefault(),s.handleRegisterFormEvent(m.RegisterFormEvent.REGISTER_CLICK);var t=s.getFormErrors();if(t.fname||t.email||t.password||t.tos)return void s.setState({localErrors:t});s.viewComponent.getRecaptchaComponent().getWrappedComponent().submit()},s.onSubmit=function(){s.setState({isSubmitting:!0});var e=s.registerData(),t=s.props.thirdPartyInitiatedSignupData?"/ajax_thirdparty_register":"/ajax_register";n.WebRequest({url:t,type:"POST",data:e,success:function(e,t,r){s.handleSuccess(e)},error:function(e,t,r){s.handleServerErrors(JSON.parse(r))},complete:function(e,t){s.setState({isSubmitting:!1})}})},s.handleGoogleCallback=function(e){var t=s.props.googleRegisterProps||{},r=s.props.additionalParams||{},o=s.props.continuationUrl||"/";d.handleRegisterResponse(e,{registerCont:o,loginCont:t.optimisticLoginContinuationUrl||o,signupTag:r.signup_tag||"",canRedirect:s.props.canRedirect!==!1,k:r.k,eh:r.eh,signupEndpoint:s.props.signupEndpoint},void 0,function(){return s.handleRegisterFormEvent(m.RegisterFormEvent.GOOGLE_REGISTER_SUCCESS)})},s.onGoogleRegisterClick=function(){s.handleRegisterFormEvent(m.RegisterFormEvent.REGISTER_CLICK);var e=!s.props.googleRegisterProps||s.props.googleRegisterProps.popup;(new g.ProfileServicesLinkingHandler).auth_service_create_user_if_needed(h.GOOGLE,s.handleGoogleCallback,"register_form",e)},s.onInputChange=function(e){var t={},r=e.currentTarget;"fname"===r.name?t.fname=r.value:"lname"===r.name?t.lname=r.value:"email"===r.name?t.email=r.value:"password"===r.name?t.password=r.value:"tos_agree"===r.name&&(t.tosAgree=r.checked),s.setState(t),s.clearFormErrors(t)},i.assert(t.canRedirect!==!1||!!t.onRegisterSuccess,"Need an on register success handler if we cannot redirect the user",{tags:["react-register-form"]}),s.state={localErrors:{},isSubmitting:!1,fname:t.fnameProps&&t.fnameProps.initialValue||"",lname:t.lnameProps&&t.lnameProps.initialValue||"",email:t.emailProps&&t.emailProps.initialValue||"",password:"",tosAgree:t.tosCheckboxProps&&t.tosCheckboxProps.checked||!1},s}return s.__extends(t,e),t.prototype.handleServerErrors=function(e){var t=s.__assign({},this.state.localErrors);e.email&&(t.email=e.email),e.password&&(t.password=e.password),e.fname&&(t.fname=e.fname),e.tos_agree&&(t.tos=e.tos_agree),e.recaptcha_response&&(t.captcha=e.recaptcha_response),this.viewComponent.handleRecaptchaErrors(e),this.setState({localErrors:t})},t.prototype.handleSuccess=function(e){var t=JSON.parse(e),s={id:t.id,email:t.email,display_name:t.display_name};if(this.handleRegisterFormEvent(m.RegisterFormEvent.REGISTER_IMMEDIATE_SUCCESS,{userInfo:s}),this.props.canRedirect!==!1){var r=this.props.continuationUrl||t.redirect_url||"/";a.redirect(r)}else this.props.onRegisterSuccess&&this.props.onRegisterSuccess(s)},t.prototype.handleRegisterFormEvent=function(e,t){this.props.onRegisterFormEvent&&this.props.onRegisterFormEvent(e,t)},t.prototype.registerData=function(){var e=this.state.fname,t=this.state.lname;this.props.combinedName&&(n=u.splitFullName(this.state.fname),e=n[0],t=n[1],l.lastNameGoesFirst()&&(p=[t,e],e=p[0],t=p[1]));var r={fname:e,lname:t,email:this.state.email,password:this.state.password,tos_agree:this.state.tosAgree,signup_endpoint:this.props.signupEndpoint},o=a.get_uri().getQuery(),i={demandbase_override:o.demandbase_override};return r=s.__assign({},r,this.viewComponent.getRecaptchaResponses(),this.props.additionalParams,this.props.thirdPartyInitiatedSignupData||{},i);var n,p},t.prototype.clearFormErrors=function(e){var t=this.state.localErrors;e.fname&&(t.fname={}),e.email&&(t.email={}),e.password&&(t.password={}),e.tosAgree&&(t.tos={}),this.setState({localErrors:t})},t.prototype.getFormErrors=function(){var e={};return this.props.validateClientSide?(this.state.fname?e.fname=void 0:e.fname={message_text:o._("Please enter your name")},this.state.email?e.email=void 0:e.email={message_text:o._("Please enter an email address")},this.state.password?e.password=void 0:e.password={message_text:o._("Please enter a password")},this.state.tosAgree?e.tos=void 0:e.tos={message_text:o._("Please agree to the terms of service")},e):e},t.prototype.componentDidMount=function(){this.props.markTti&&f.mark_time_to_interactive()},t.prototype.render=function(){return r.createElement(c.RegisterFormView,{ref:this.setViewComponent,variant:this.props.variant||p.AuthFormVariant.STANDARD,maestroStyle:this.props.maestroStyle||!1,disabled:this.props.disabled||!1,className:this.props.className,combinedName:this.props.combinedName||!1,fnameProps:this.props.fnameProps||{},fnameValue:this.state.fname,fnameError:this.state.localErrors.fname,lnameProps:this.props.lnameProps||{},lnameValue:this.state.lname,emailProps:this.props.emailProps||{},emailValue:this.state.email,emailError:this.state.localErrors.email,passwordProps:this.props.passwordProps||{},passwordValue:this.state.password,passwordError:this.state.localErrors.password,tosCheckboxProps:this.props.tosCheckboxProps||{},tosChecked:this.state.tosAgree,tosError:this.state.localErrors.tos,submitButtonProps:this.props.submitButtonProps||{},googleRegisterProps:this.props.googleRegisterProps,thirdPartyInitiatedSignup:!!this.props.thirdPartyInitiatedSignupData,isSubmitting:this.state.isSubmitting,onClickSignUp:this.onClickSignUp,onInputChange:this.onInputChange,onSubmit:this.onSubmit,onGoogleRegisterClick:this.onGoogleRegisterClick,recaptchaEndpoint:this.props.recaptchaEndpoint||"/ajax_needs_signup_captcha",recaptchaError:this.state.localErrors.captcha})},t})(r.Component);t.TestOnlyRegisterFormComponent=v,t.RegisterForm=_(v,["/static/css/login_or_register-vfl9esD0O.css","/static/css/components/login_form-vflEBYWs2.css","/static/css/components/button-vfl-_t7Pp.css"])});
//# sourceMappingURL=form.min.js-vflGKNWHx.map