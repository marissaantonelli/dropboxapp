define(["require","exports","tslib","modules/clean/ajax","external/classnames","external/react","modules/clean/auth_event_logger","modules/clean/react/css","modules/core/i18n","modules/core/notify","modules/clean/abuse/recaptcha_helper","modules/clean/auth/common/error","modules/clean/react_format","modules/constants/login_and_register"],function(e,t,a,r,c,i,n,s,o,p,_,h,l,u){"use strict";function d(e){var t=e.getWrappedComponent();return{"g-recaptcha-response":t.recaptcha_response,"g-recaptcha-response-v3":t.recaptcha_response_v3}}function v(e,t){return e.getWrappedComponent().handle_recaptcha_errors(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.get_recaptcha_responses=d,t.handle_recaptcha_errors=v;var m=(function(e){function t(t){return e.call(this,t)||this}return a.__extends(t,e),t.prototype.render_recaptcha=function(e,t){var a=this;if(this.refs.container_div.style.display="block",void 0!==this.recaptcha_id)e.reset(this.recaptcha_id),void 0!==this.invisible_recaptcha_id&&e.reset(this.invisible_recaptcha_id);else{var c=void 0;this.use_invisible_recaptcha()?(this.invisible_recaptcha_id=e.render(this.refs.captcha_div,{size:"invisible",sitekey:u.INVISIBLE_RECAPTCHA_SITE_KEY,callback:function(t){r.BackgroundRequest({url:"/log_invisible_recaptcha_event",data:{email:a.props.email,event:"INVISIBLE_RECAPTCHA_PASSED_"+a.props.source}}),a.recaptcha_response_v3=void 0,a.recaptcha_response=t,e.reset(a.invisible_recaptcha_id),a.props.onSubmit()}}),this.recaptcha_id=e.render(this.refs.captcha_div_2,{size:"invisible",sitekey:u.RECAPTCHA_V3_SITE_KEY,callback:function(t){a.recaptcha_response_v3=t,e.reset(a.recaptcha_id),a.props.onSubmit()}})):(c={sitekey:t,callback:function(e){a.recaptcha_response=e}},this.recaptcha_id=e.render(this.refs.captcha_div,c))}},t.prototype.use_invisible_recaptcha=function(){return u.INVISIBLE_RECAPTCHA&&this.props.use_invisible_recaptcha_if_available},t.prototype.load_recaptcha_if_needed=function(){var e=this;return new Promise(function(t,a){if(e.use_invisible_recaptcha())return void t(!1);r.WebRequest({url:e.props.endpoint,data:{email:e.props.email},success:function(a){var r=JSON.parse(a),c=!!r.needs_captcha;_.LoadRecaptcha().then(function(a){c&&e.render_recaptcha(a,r.recaptcha_v2_public_key),t(c)})},error:function(){p.Notify.error(o._("There was a problem completing this request.")),a()}})})},t.prototype.handle_recaptcha_errors=function(e){var t=this;!this.use_invisible_recaptcha()&&e&&e.recaptcha_response?this.load_recaptcha_if_needed():this.use_invisible_recaptcha()&&e&&e.recaptcha_response_v3&&(this.log_recaptcha_start_event(this.props.source),_.LoadRecaptcha().then(function(e){e.execute(t.invisible_recaptcha_id)}))},t.prototype.log_recaptcha_start_event=function(e){r.BackgroundRequest({url:"/log_invisible_recaptcha_event",data:{email:this.props.email,event:"INVISIBLE_RECAPTCHA_START_"+e}}),"LOGIN"===e?n.AuthEventLogger.log_web_login_captcha():n.AuthEventLogger.log_web_signup_captcha()},t.prototype.componentDidMount=function(){var e=this;_.LoadRecaptcha().then(function(t){e.use_invisible_recaptcha()?e.render_recaptcha(t,u.INVISIBLE_RECAPTCHA_SITE_KEY):e.load_recaptcha_if_needed()})},t.prototype.render=function(){var e=i.createElement("span",null);return this.use_invisible_recaptcha()&&(e=i.createElement("div",{className:"recaptcha-terms-text"},l.reactFormat("This page is protected by reCAPTCHA, and subject to the Google <a_p>Privacy Policy</a_p> and <a_t>Terms of service</a_t>.",{a_p:i.createElement("a",{href:"https://www.google.com/policies/privacy/",target:"_blank",rel:"noopener noreferrer"}),a_t:i.createElement("a",{href:"https://www.google.com/policies/terms/",target:"_blank",rel:"noopener noreferrer"})}))),i.createElement("div",{ref:"container_div",className:c({"recaptcha-v2-challenge-container":!0,"recaptcha-v2-challenge-container--invisible":this.use_invisible_recaptcha()})},e,i.createElement(h.AuthError,{error:this.props.error}),i.createElement("div",{ref:"captcha_div",className:"recaptcha_v2_challenge"}),i.createElement("div",{ref:"captcha_div_2",className:"recaptcha_v2_challenge"}))},t.prototype.submit=function(){var e=this;this.use_invisible_recaptcha()?_.LoadRecaptcha().then(function(t){return t.execute(e.recaptcha_id)}):this.props.onSubmit()},t})(i.Component);t.Recaptcha=s(m,["/static/css/recaptcha-vflIN6j39.css"])});
//# sourceMappingURL=recaptcha.min.js-vflEPnCbG.map